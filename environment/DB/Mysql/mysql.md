---
 Author: mazhuang
 Date: 2020-08-13 16:42:27
 LastEditTime: 2020-08-14 11:18:31
 Description: 
---
# Mysql

## Foreign Key

该不该使用**外键**，需要看使用场景，需要分析数据库承担部分计算任务（外键**一致性**）后会不会影响系统的可用性

参考博客：[为什么数据库不应该使用外键](https://draveness.me/whys-the-design-database-foreign-key/)

- 不使用外键牺牲了数据库中数据的一致性，但是却能够减少数据库的负载；
- 模拟外键将一部分工作移到了数据库之外，我们可能需要放弃一部分一致性以获得更高的可用性，但是为了这部分可用性，我们会付出更多的研发与维护成本，也增加了与数据库之间的网络通信次数；
- 使用外键保证了数据库中数据的一致性，也将全部的计算任务全部交给了数据库；

外键类型：

- `RESTRICT` 外键会在更新和删除关系表中的数据时对外键约束的合法性进行检查，保证外键不会引用到不存在的记录；
- `CASCADE` 外键会在更新和删除关系表中的数据时触发对关联记录的更新和删除，在数据量较大的数据库中可能会有数量级的放大效果；

## Soft Delete

golang 的 `grom` 为数据库表添加 `deleted_at` 的时间戳字段，`null` 表示未被删除，非 `null` 表示已经被删除了

使用软删除可以备份以删除的数据，方便**误删恢复**,适用于数据很重要，不希望被误删，且不需要唯一索引，不需要外键，数据量也不会太多

对于唯一索引和外键的会产生冲突，详见[软删除之痛](https://blog.wolfogre.com/posts/trap-of-soft-delete/)

## NULL

MySQL 中的 `NULL` 的含义是“一个缺失的、未知的值”， 不能用于比较

```sql
mysql> select 1 is NULL, 1 is not NULL;
+-----------+---------------+
| 1 is NULL | 1 is not NULL |
+-----------+---------------+
|         0 |             1 |
+-----------+---------------+
1 row in set (0.03 sec)

mysql> select 1 = NULL, 1 != NULL, 1 < NULL, 1 > NULL, NULL = NULL, NULL != NULL;
+----------+-----------+----------+----------+-------------+--------------+
| 1 = NULL | 1 != NULL | 1 < NULL | 1 > NULL | NULL = NULL | NULL != NULL |
+----------+-----------+----------+----------+-------------+--------------+
|     NULL |      NULL |     NULL |     NULL |        NULL |         NULL |
+----------+-----------+----------+----------+-------------+--------------+
1 row in set (0.03 sec)
```
