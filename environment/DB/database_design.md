# database文档书写规范

- [文档大纲](#%e6%96%87%e6%a1%a3%e5%a4%a7%e7%ba%b2)
- [数据库设计原则](#%e6%95%b0%e6%8d%ae%e5%ba%93%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99)
  - [mongodb设计原则](#mongodb%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99)
  - [mysql设计原则](#mysql%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99)

## 文档大纲

```markdown
# 项目名

项目名下必须有目录，可用插件(**Markdown All in One**)自动生成，目录最多三层

- [一级目录](项目名)
  - [二级目录](需求分析)
    - [三级目录](基本需求)

## 需求分析

简述项目需求（可忽略）

### 基本需求

详细描述项目需求

### 分析结构

根据需求抽象出实体对象，描述实体所含**约束**、**关系**、**主键**、**外键**、**其他列**等，分库分表，  
关系型数据库要求有 E-R 图，

## 数据库表设计

简单的数据库说明，包含数据库名、特殊符号说明、数据库类型、关系类型、字符描述、数据类型等， 例如：

- 数据库名：bmi_sdc
  - sdc: Smart data cloud
  - 数据库类型：mongodb
  - 关系类型：NoSql
  - 数据类型：

### 表/文档名，格式为：中文(英文名)

表名、字段名为全小写，多个单词用下划线连接  
简述表的用途，
- 字段信息

| Field    | Type     | Default | Comment |
| -------- | -------- | ------- | ------- |
| id       | ObjectId | (NULL)  |
| username | string   | (NULL)  | 预留    |
| password | string   | (NULL)  |
| nickname | string   | (NULL)  | 昵称    |

内嵌结构，用新表重新描述

```

## 数据库设计原则

1. **数据库设计最起码要占用整个项目开发的40%以上的时间**  
   数据库是需求的直观反应和表现，因此设计时必须要切实符合用户的需求，要多次与用户沟通交流来细化需求，将需求中的要求和每一次的变化都要一一体现在数据库的设计当中。如果需求不明确，就要分析不确定的因素，设计表时就要事先预留出可变通的字段，正所谓“有备无患”

2. **数据库设计不仅仅停留于页面demo的表面**  
   页面内容所需要的字段，在数据库设计中只是一部分，还有系统运转、模块交互、中转数据、表之间的联系等等所需要的字段，因此数据库设计绝对不是简单的基本数据存储，还有逻辑数据存储。

3. **数据库设计完成后，项目80%的设计开发在你脑海中就已经完成了**  
   每个字段的设计都是有他必要的意义的，你在设计每一个字段的同时，就应该已经想清楚程序中如何去运用这些字段，多张表的联系在程序中是如何体现的。换句话说，你完成数据库设计后，程序中所有的实现思路和实现方式在你的脑海中就已经考虑过了。如果达不到这种程度，那当进入编码阶段后，才发现要运用的技术或实现的方式数据库无法支持，这时再改动数据库就会很麻烦，会造成一系列不可预测的问题。

4. **数据库设计时就要考虑到效率和优化问题**  
   一开始就要分析哪些表会存储较多的数据量，对于数据量较大的表的设计往往是粗粒度的，也会冗余一些必要的字段，已达到尽量用最少的表、最弱的表关系去存储海量的数据。并且在设计表时，一般都会对主键建立聚集索引，含有大数据量的表更是要建立索引以提供查询性能。对于含有计算、数据交互、统计这类需求时，还要考虑是否有必要采用存储过程。

5. **添加必要的（冗余）字段**  
   像“创建时间”、“修改时间”、“备注”、“操作用户IP”和一些用于其他需求（如统计）的字段等，在每张表中必须都要有，不是说只有系统中用到的数据才会存到数据库中，一些冗余字段是为了便于日后维护、分析、拓展而添加的，这点是非常重要的，比如黑客攻击，篡改了数据，我们便就可以根据修改时间和操作用户IP来查找定位。

6. **设计合理的表关联**  
   若多张表之间的关系复杂，建议采用第三张映射表来关联维护两张表之间的关系，以降低表之间的直接耦合度。若多张表涉及到大数据量的问题，表结构尽量简单，关联也要尽可能避免。

7. **设计表时不加主外键等约束性关联，系统编码阶段完成后再添加约束性关联**  
   这样做的目的是有利于团队并行开发，减少编码时所遇到的问题，表之间的关系靠程序来控制。编码完成后再加关联并进行测试。不过也有一些公司的做法是干脆就不加表关联。

8. **选择合适的主键生成策略**  
   主键生成策略大致可分：int自增长类型（identity、sequence）、手动增长类型（建立单独一张表来维护）、手动维护类型（如userId）、字符串类型（uuid、guid）。int型的优点是使用简单、效率高，但多表之间数据合并时就很容易出现问题，手动增长类型和字符串类型能很好解决多表数据合并的问题，但同样也都有缺点：前者的缺点是增加了一次数据库访问来获取主键，并且又多维护一张主键表，增加了复杂度；而后者是非常占用存储空间，且表关联查询的效率低下，索引的效率也不高，跟int类型正好相反。

### mongodb设计原则

1. 优先考虑内嵌，除非有什么迫不得已的原因。  
2. 需要单独访问一个对象，那这个对象就不适合被内嵌到其他对象中。  
3. 数组不应该无限制增长。如果many端有数百个文档对象就不要去内嵌他们可以采用引用ObjectID的方案；如果有数千个文档对象，那么就不要内嵌ObjectID的数组。该采取哪些方案取决于数组的大小。  
4. 在进行反范式设计时请先确认读写比。一个几乎不更改只是读取的字段才适合冗余到其他对象中。

### mysql设计原则

To Be Continue
